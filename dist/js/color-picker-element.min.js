// ColorPickerElement v0.0.1alpha2 | thednp © 2022 | MIT-License
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).ColorPickerElement=t()}(this,(function(){"use strict";function e(e){return e instanceof HTMLElement?e.ownerDocument:e instanceof Window?e.document:window.document}const t=[Document,Element,HTMLElement],o=[Element,HTMLElement];function n(n,r){const a=t.some(e=>r instanceof e)?r:e();return o.some(e=>n instanceof e)?n:a.querySelector(n)}const r=(e,t)=>Object.assign(e,t);function a(t){if("string"==typeof t)return e().createElement(t);const{tagName:o}=t,n={...t},i=a(o);return delete n.tagName,r(i,n),i}function i(e,t){const o=getComputedStyle(e);return t in o?o[t]:""}const s=(e,t)=>{r(e.style,t)},l=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","goldenrod","gold","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavenderblush","lavender","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],c=["transparent","currentColor","inherit","initial"],h="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",u=`[\\s|\\(]+(${h})[,|\\s]+(${h})[,|\\s]+(${h})\\s*\\)?`,d=`[\\s|\\(]+(${h})[,|\\s]+(${h})[,|\\s]+(${h})[,|\\s]+(${h})\\s*\\)?`,g={CSS_UNIT:new RegExp(h),rgb:new RegExp("rgb"+u),rgba:new RegExp("rgba"+d),hsl:new RegExp("hsl"+u),hsla:new RegExp("hsla"+d),hsv:new RegExp("hsv"+u),hsva:new RegExp("hsva"+d),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function p(e){return"string"==typeof e&&e.includes(".")&&1===parseFloat(e)}function b(e){return"string"==typeof e&&e.includes("%")}function m(e){return Boolean(g.CSS_UNIT.exec(String(e)))}function f(e,t){let o=e;return p(e)&&(o="100%"),o=360===t?o:Math.min(t,Math.max(0,parseFloat(o))),b(o)&&(o=parseInt(String(o*t),10)/100),Math.abs(o-t)<1e-6?1:(o=360===t?(o<0?o%t+t:o%t)/parseFloat(String(t)):o%t/parseFloat(String(t)),o)}function w(e){let t=parseFloat(e);return(Number.isNaN(t)||t<0||t>1)&&(t=1),t}function v(e){return Math.min(1,Math.max(0,e))}function x(t){const o=e(n).head;var n;s(o,{color:t});const r=i(o,"color");return s(o,{color:""}),r}function k(e){return e<=1?100*Number(e)+"%":e}function y(e){return 1===e.length?"0"+e:String(e)}function S(e,t,o){return{r:255*f(e,255),g:255*f(t,255),b:255*f(o,255)}}function C(e,t,o){const n=f(e,255),r=f(t,255),a=f(o,255),i=Math.max(n,r,a),s=Math.min(n,r,a);let l=0,c=0;const h=(i+s)/2;if(i===s)c=0,l=0;else{const e=i-s;switch(c=h>.5?e/(2-i-s):e/(i+s),i){case n:l=(r-a)/e+(r<a?6:0);break;case r:l=(a-n)/e+2;break;case a:l=(n-r)/e+4}l/=6}return{h:l,s:c,l:h}}function M(e,t,o){let n=o;return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*n*(t-e):n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function $(e,t,o){let n=0,r=0,a=0;const i=f(e,360),s=f(t,100),l=f(o,100);if(0===s)r=l,a=l,n=l;else{const e=l<.5?l*(1+s):l+s-l*s,t=2*l-e;n=M(t,e,i+1/3),r=M(t,e,i),a=M(t,e,i-1/3)}return{r:255*n,g:255*r,b:255*a}}function L(e,t,o){const n=f(e,255),r=f(t,255),a=f(o,255),i=Math.max(n,r,a),s=Math.min(n,r,a);let l=0;const c=i,h=i-s,u=0===i?0:h/i;if(i===s)l=0;else{switch(i){case n:l=(r-a)/h+(r<a?6:0);break;case r:l=(a-n)/h+2;break;case a:l=(n-r)/h+4}l/=6}return{h:l,s:u,v:c}}function P(e,t,o){const n=6*f(e,360),r=f(t,100),a=f(o,100),i=Math.floor(n),s=n-i,l=a*(1-r),c=a*(1-s*r),h=a*(1-(1-s)*r),u=i%6;return{r:255*[a,c,l,l,h,a][u],g:255*[h,a,a,c,l,l][u],b:255*[l,l,h,a,a,c][u]}}function N(e,t,o){return[y(Math.round(e).toString(16)),y(Math.round(t).toString(16)),y(Math.round(o).toString(16))].join("")}function E(e){return H(e)/255}function H(e){return parseInt(e,16)}function A(e){return{r:e>>16,g:(65280&e)>>8,b:255&e}}function R(e){let t=e.trim().toLowerCase();if(0===t.length)return{r:0,g:0,b:0,a:0};let o=!1;if(l.includes(t))t=x(t),o=!0;else if(c.includes(t))return{r:255,g:255,b:255,a:1,format:"rgb"};let n=g.rgb.exec(t);return n?{r:n[1],g:n[2],b:n[3]}:(n=g.rgba.exec(t),n?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=g.hsl.exec(t),n?{h:n[1],s:n[2],l:n[3]}:(n=g.hsla.exec(t),n?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=g.hsv.exec(t),n?{h:n[1],s:n[2],v:n[3]}:(n=g.hsva.exec(t),n?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=g.hex8.exec(t),n?{r:H(n[1]),g:H(n[2]),b:H(n[3]),a:E(n[4]),format:o?"rgb":"hex8"}:(n=g.hex6.exec(t),n?{r:H(n[1]),g:H(n[2]),b:H(n[3]),format:o?"rgb":"hex"}:(n=g.hex4.exec(t),n?{r:H(n[1]+n[1]),g:H(n[2]+n[2]),b:H(n[3]+n[3]),a:E(n[4]+n[4]),format:o?"rgb":"hex8"}:(n=g.hex3.exec(t),!!n&&{r:H(n[1]+n[1]),g:H(n[2]+n[2]),b:H(n[3]+n[3]),format:o?"rgb":"hex"})))))))))}function T(e){let t,o={r:0,g:0,b:0},n=e,r=null,a=null,i=null,s=!1,l="hex";return"string"==typeof e&&(n=R(e),n&&(s=!0)),"object"==typeof n&&(m(n.r)&&m(n.g)&&m(n.b)?(o=S(n.r,n.g,n.b),s=!0,l="%"===(""+n.r).slice(-1)?"prgb":"rgb"):m(n.h)&&m(n.s)&&m(n.v)?(r=k(n.s),a=k(n.v),o=P(n.h,r,a),s=!0,l="hsv"):m(n.h)&&m(n.s)&&m(n.l)&&(r=k(n.s),i=k(n.l),o=$(n.h,r,i),s=!0,l="hsl"),"a"in n&&(t=n.a)),{ok:s,format:n.format||l,r:Math.min(255,Math.max(o.r,0)),g:Math.min(255,Math.max(o.g,0)),b:Math.min(255,Math.max(o.b,0)),a:w(t)}}class D{constructor(e,t){let o=e;const n=t&&["hex","rgb","hsl"].includes(t)?t:"hex";o instanceof D&&(o=T(o)),"number"==typeof o&&(o=A(o));const{r:r,g:a,b:i,a:s,ok:l,format:c}=T(o);this.originalInput=o,this.r=r,this.g=a,this.b=i,this.a=s,this.ok=l,this.roundA=Math.round(100*this.a)/100,this.format=n||c,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b))}get isValid(){return this.ok}get isDark(){return this.brightness<128}get luminance(){const{r:e,g:t,b:o}=this;let n=0,r=0,a=0;const i=e/255,s=t/255,l=o/255;return n=i<=.03928?i/12.92:((i+.055)/1.055)**2.4,r=s<=.03928?s/12.92:((s+.055)/1.055)**2.4,a=l<=.03928?l/12.92:((l+.055)/1.055)**2.4,.2126*n+.7152*r+.0722*a}get brightness(){const{r:e,g:t,b:o}=this;return(299*e+587*t+114*o)/1e3}toRgb(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}}toRgbString(){const e=Math.round(this.r),t=Math.round(this.g),o=Math.round(this.b);return 1===this.a?`rgb(${e},${t},${o})`:`rgba(${e},${t},${o},${this.roundA})`}toHex(){return N(this.r,this.g,this.b)}toHexString(){return"#"+this.toHex()}toHsv(){const{h:e,s:t,v:o}=L(this.r,this.g,this.b);return{h:360*e,s:t,v:o,a:this.a}}toHsl(){const{h:e,s:t,l:o}=C(this.r,this.g,this.b);return{h:360*e,s:t,l:o,a:this.a}}toHslString(){let{h:e,s:t,l:o}=this.toHsl();return e=Math.round(e),t=Math.round(100*t),o=Math.round(100*o),1===this.a?`hsl(${e},${t}%,${o}%)`:`hsla(${e},${t}%,${o}%,${this.roundA})`}setAlpha(e){return this.a=w(e),this.roundA=Math.round(100*this.a)/100,this}saturate(e){if(!e)return this;const t=this.toHsl();return t.s+=e/100,t.s=v(t.s),new D(t)}desaturate(e){return e?this.saturate(-e):this}greyscale(){return this.desaturate(100)}clone(){return new D(this)}toString(){const{format:e}=this;return"rgb"===e?this.toRgbString():"hsl"===e?this.toHslString():this.toHexString()}}r(D,{webColors:l,CSS_INTEGER:"[-\\+]?\\d+%?",CSS_NUMBER:"[-\\+]?\\d*\\.\\d+%?",CSS_UNIT:h,PERMISSIVE_MATCH3:u,PERMISSIVE_MATCH4:d,matchers:g,isOnePointZero:p,isPercentage:b,isValidCSSUnit:m,bound01:f,boundAlpha:w,clamp01:v,getHexFromColorName:x,convertToPercentage:k,convertHexToDecimal:E,pad2:y,rgbToRgb:S,rgbToHsl:C,rgbToHex:N,rgbToHsv:L,hslToRgb:$,hsvToRgb:P,hue2rgb:M,parseIntFromHex:H,numberInputToObject:A,stringInputToObject:R,inputToRGB:T});const F={};function I(e){const t=this,{type:o}=e;(F[o]?[...F[o]]:[]).forEach(n=>{const[r,a]=n;[...a].forEach(n=>{if(r===t){const[t,a]=n;t.apply(r,[e]),a&&a.once&&V(r,o,t,a)}})})}const O=(e,t,o,n)=>{F[t]||(F[t]=new Map);const r=F[t];r.has(e)||r.set(e,new Map);const a=r.get(e),{size:i}=a;a&&a.set(o,n),i||e.addEventListener(t,I,n)},V=(e,t,o,n)=>{const r=F[t],a=r&&r.get(e),i=a&&a.get(o),{options:s}=void 0!==i?i:{options:n};a&&a.has(o)&&a.delete(o),!r||a&&a.size||r.delete(e),r&&r.size||delete F[t],a&&a.size||e.removeEventListener(t,I,s)},K="ArrowDown",q="ArrowUp",U="ArrowLeft",G="ArrowRight",_="Enter",j="Space";const{userAgentData:B}=navigator,z=B,{userAgent:X}=navigator,Y=X,W=/iPhone|iPad|iPod|Android/i;let J=!1;J=z?z.brands.some(e=>W.test(e.brand)):W.test(Y);const Z=J;let Q=0,ee=0;const te=new Map;function oe(e,t){const{width:o,height:n,top:r,right:a,bottom:i,left:s}=e.getBoundingClientRect();let l=1,c=1;if(t&&e instanceof HTMLElement){const{offsetWidth:t,offsetHeight:r}=e;l=t>0&&Math.round(o)/t||1,c=r>0&&Math.round(n)/r||1}return{width:o/l,height:n/c,top:r/c,right:a/l,bottom:i/c,left:s/l,x:s/l,y:r/c}}function ne(o,n){return(n&&t.some(e=>n instanceof e)?n:e()).querySelectorAll(o)}function re(t,o){if("string"==typeof o)return e().createElementNS(t,o);const{tagName:n}=o,a={...o},i=re(t,n);return delete a.tagName,r(i,a),i}const ae=new Map,ie={set:(e,t,o)=>{const r=n(e);if(!r)return;ae.has(t)||ae.set(t,new Map);ae.get(t).set(r,o)},getAllFor:e=>ae.get(e)||null,get:(e,t)=>{const o=n(e),r=ie.getAllFor(t);return o&&r&&r.get(o)||null},remove:(e,t)=>{const o=n(e),r=ae.get(t);r&&o&&(r.delete(o),0===r.size&&ae.delete(t))}};function se(e,t){return e.classList.contains(t)}function le(e,t){e.classList.add(t)}function ce(e,t){e.classList.remove(t)}const he=(e,t,o)=>e.setAttribute(t,o),ue=(e,t)=>e.getAttribute(t),de={pickerLabel:"Colour Picker",appearanceLabel:"Colour Appearance",valueLabel:"Colour Value",toggleLabel:"Select Colour",menuLabel:"Colour Presets",formatLabel:"Format",alphaLabel:"Alpha",hexLabel:"Hexadecimal",hueLabel:"Hue",saturationLabel:"Saturation",lightnessLabel:"Lightness",redLabel:"Red",greenLabel:"Green",blueLabel:"Blue"},ge=["white","black","grey","red","orange","brown","gold","olive","yellow","lime","green","teal","cyan","blue","violet","magenta","pink"];const pe=e=>{return t=e,o="color-picker",ie.get(t,o);var t,o};function be(e){const{input:t,parent:o,format:n,id:i,componentLabels:s,keywords:l}=e,h=ue(t,"value")||"#fff",{toggleLabel:u,menuLabel:d,pickerLabel:g,formatLabel:p,hexLabel:b}=s,m=c.includes(h)?"#fff":h;e.color=new D(m,n);const f=Z?" mobile":"",w="hex"===n?b:n.toUpperCase(),v=a({id:"picker-btn-"+i,tagName:"button",className:"picker-toggle button-appearance"});he(v,"aria-expanded","false"),he(v,"aria-haspopup","true"),v.append(a({tagName:"span",className:"v-hidden",innerText:`${g}. ${p}: ${w}`}));const x=a({tagName:"div",className:"color-dropdown picker"+f});he(x,"aria-labelledby","picker-btn-"+i),he(x,"role","group");const k=function(e){const{format:t,componentLabels:o}=e,{hueLabel:n,alphaLabel:r,lightnessLabel:i,saturationLabel:s}=o,l=Z?150:230,c=Z?150:230,h="hsl"===t?360:100,u="hsl"===t?100:360,d="hsl"===t?`${n} & ${i}`:`${i} & ${s}`,g="hsl"===t?""+s:""+n,p=a({tagName:"div",className:"color-controls "+t}),b=[{w:l,h:c,i:1,c:"color-pointer",l:d,min:0,max:h},{w:21,h:c,i:2,c:"color-slider",l:g,min:0,max:u}];return"hex"!==t&&b.push({w:21,h:c,i:3,c:"color-slider",l:r,min:0,max:100}),b.forEach(e=>{const{w:t,h:o,i:n,c:r,l:i,min:s,max:l}=e,c=a({tagName:"div",className:"color-control"});he(c,"role","presentation"),c.append(a({tagName:"canvas",className:"visual-control"+n,ariaHidden:"true",width:""+t,height:""+o}));const h=a({tagName:"div",className:r+" knob",ariaLive:"polite"});he(h,"aria-label",i),he(h,"role","slider"),he(h,"tabindex","0"),he(h,"aria-valuemin",""+s),he(h,"aria-valuemax",""+l),c.append(h),p.append(c)}),p}(e),y=function(e){const{format:t,id:o,componentLabels:n}=e,i=a({tagName:"div",className:"color-form "+t});let s=["hex"];return"rgb"===t?s=["red","green","blue","alpha"]:"hsl"===t&&(s=["hue","saturation","lightness","alpha"]),s.forEach(e=>{const[s]="hex"===t?["#"]:(l=e,l.toUpperCase()).split("");var l;const c=`color_${t}_${e}_${o}`,h=n[e+"Label"],u=a({tagName:"label"});he(u,"for",c),u.append(a({tagName:"span",ariaHidden:"true",innerText:s+":"}),a({tagName:"span",className:"v-hidden",innerText:h}));const d=a({tagName:"input",id:c,type:"hex"===t?"text":"number",value:"alpha"===e?"1":"0",className:"color-input "+e,autocomplete:"off",spellcheck:"false"});if("hex"!==t){let o="1",n="0.01";"alpha"!==e&&("rgb"===t?(o="255",n="1"):"hue"===e?(o="360",n="1"):(o="100",n="1")),r(d,{min:"0",max:o,step:n})}i.append(u,d)}),i}(e);if(x.append(k,y),t.before(v),o.append(x),l){const e=l,r=a({tagName:"div",className:"color-dropdown menu"+f}),i=a({tagName:"ul",className:"color-menu"});he(i,"role","listbox"),he(i,"aria-label",""+d),r.append(i),e.forEach(e=>{const o=e.trim(),r=new D(o,n).toString()===ue(t,"value"),s=a({tagName:"li",className:"color-option"+(r?" active":""),innerText:""+e});he(s,"tabindex","0"),he(s,"data-value",""+o),he(s,"role","option"),he(s,"aria-selected",r?"true":"false"),i.append(s)});const s=a({tagName:"button",className:"menu-toggle button-appearance"});he(s,"tabindex","-1"),he(s,"aria-expanded","false"),he(s,"aria-haspopup","true");const c=encodeURI("http://www.w3.org/2000/svg"),h=re(c,{tagName:"svg"});he(h,"xmlns",c),he(h,"viewBox","0 0 512 512"),he(h,"aria-hidden","true");const g=re(c,{tagName:"path"});he(g,"d","M98,158l157,156L411,158l27,27L255,368L71,185L98,158z"),he(g,"fill","#fff"),h.append(g),s.append(a({tagName:"span",className:"v-hidden",innerText:""+u}),h),o.append(s,r)}l&&c.includes(h)&&(e.value=h),he(t,"tabindex","-1")}function me(e,t){const o=t?O:V,{input:n,pickerToggle:r,menuToggle:a}=e;o(n,"focusin",e.showPicker),o(r,"click",e.togglePicker),o(n,"keydown",e.keyHandler),a&&o(a,"click",e.toggleMenu)}function fe(t,o){const n=o?O:V,{input:r,colorMenu:a,parent:i}=t,s=e(r),l=function(e){if(null==e)return window;if(!(e instanceof Window)){const{ownerDocument:t}=e;return t&&t.defaultView||window}return e}(r),c="ontouchstart"in s?{down:"touchstart",move:"touchmove",up:"touchend"}:{down:"mousedown",move:"mousemove",up:"mouseup"};n(t.controls,c.down,t.pointerDown),t.controlKnobs.forEach(e=>n(e,"keydown",t.handleKnobs)),n(l,"scroll",t.handleScroll),[r,...t.inputs].forEach(e=>n(e,"change",t.changeHandler)),a&&(n(a,"click",t.menuClickHandler),n(a,"keydown",t.menuKeyHandler)),n(s,c.move,t.pointerMove),n(s,c.up,t.pointerUp),n(i,"focusout",t.handleFocusOut),n(l,"keyup",t.handleDismiss)}function we(e){var t,o;t=e.input,o=new CustomEvent("colorpicker.change"),t.dispatchEvent(o)}function ve(e){e&&["bottom","top"].forEach(t=>ce(e,t))}function xe(e,t){const{colorPicker:o,colorMenu:n,menuToggle:r,pickerToggle:a,parent:i}=e,s=t===o,l=s?n:o,c=s?r:a,h=s?a:r;se(i,"open")||le(i,"open"),ce(l,"show"),ve(l),le(t,"bottom"),t.offsetHeight,le(t,"show"),e.show(),he(h,"aria-expanded","true"),he(c,"aria-expanded","false")}class ke{constructor(o){const a=this;if(a.input=n(o),!a.input)throw new TypeError(`ColorPicker target ${o} cannot be found.`);const{input:i}=a,s=pe(i);if(s)return s;if(a.parent=function e(t,o){return t?t.closest(o)||e(t.getRootNode().host,o):null}(i,".color-picker,color-picker"),!a.parent)throw new TypeError("ColorPicker requires a specific markup to work.");a.id=function e(t,o){let n=o?Q:ee;if(o){const r=e(t),a=te.get(r)||new Map;te.has(r)||te.set(r,a),a.has(o)?n=a.get(o):(a.set(o,n),Q+=1)}else{const e=t.id||t;te.has(e)?n=te.get(e):(te.set(e,n),ee+=1)}return n}(i,"color-picker"),a.dragElement=null,a.isOpen=!1,a.controlPositions={c1x:0,c1y:0,c2y:0,c3y:0},a.colorLabels={},a.keywords=!1,a.color=new D("white",a.format);const{componentLabels:l,colorLabels:h,keywords:u}=i.dataset,d=h&&17===h.split(",").length?h.split(","):ge;ge.forEach((e,t)=>{a.colorLabels[e]=d[t].trim()});const g=r({},de),p=l&&function(e){try{JSON.parse(e)}catch(e){return!1}return!0}(l)?JSON.parse(l):{};a.componentLabels=r(g,p),"false"!==u&&(a.keywords=u?u.split(","):c),a.showPicker=a.showPicker.bind(a),a.togglePicker=a.togglePicker.bind(a),a.toggleMenu=a.toggleMenu.bind(a),a.menuClickHandler=a.menuClickHandler.bind(a),a.menuKeyHandler=a.menuKeyHandler.bind(a),a.pointerDown=a.pointerDown.bind(a),a.pointerMove=a.pointerMove.bind(a),a.pointerUp=a.pointerUp.bind(a),a.handleScroll=a.handleScroll.bind(a),a.handleFocusOut=a.handleFocusOut.bind(a),a.changeHandler=a.changeHandler.bind(a),a.handleDismiss=a.handleDismiss.bind(a),a.keyHandler=a.keyHandler.bind(a),a.handleKnobs=a.handleKnobs.bind(a),be(a);const{parent:b}=a,[m,f]=function(o,n){return(n&&t.some(e=>n instanceof e)?n:e()).getElementsByClassName(o)}("color-dropdown",b);a.pickerToggle=n(".picker-toggle",b),a.menuToggle=n(".menu-toggle",b),a.colorPicker=m,a.colorMenu=f,a.controls=n(".color-controls",b),a.inputs=[...ne(".color-input",b)],a.controlKnobs=[...ne(".knob",b)],a.visuals=[...ne("canvas",a.controls)],a.knobLabels=[...ne(".color-label",b)];const[w,v,x]=a.visuals;a.width1=w.width,a.height1=w.height,a.width2=v.width,a.height2=v.height,a.ctx1=w.getContext("2d"),a.ctx2=v.getContext("2d"),a.ctx1.rect(0,0,a.width1,a.height1),a.ctx2.rect(0,0,a.width2,a.height2),a.width3=0,a.height3=0,"hex"!==a.format&&(a.width3=x.width,a.height3=x.height,this.ctx3=x.getContext("2d"),a.ctx3.rect(0,0,a.width3,a.height3)),this.setControlPositions(),this.setColorAppearence(),this.updateInputs(!0),this.updateControls(),this.updateVisuals(),me(a,!0),ie.set(i,"color-picker",a)}get value(){return this.input.value}set value(e){this.input.value=e}get format(){return this.input.dataset.format||"rgb"}get includeNonColor(){return this.keywords instanceof Array&&this.keywords.some(e=>c.includes(e))}get isCE(){return"color-picker"===this.parent.tagName}get hex(){return this.color.toHex()}get hsv(){return this.color.toHsv()}get hsl(){return this.color.toHsl()}get rgb(){return this.color.toRgb()}get brightness(){return this.color.brightness}get luminance(){return this.color.luminance}get isDark(){const{rgb:e,brightness:t}=this;return t<120&&e.a>.33}get isValid(){const e=this.input.value;return""!==e&&new D(e).isValid}updateVisuals(){const{color:e,format:t,controlPositions:o,width1:n,width2:r,width3:a,height1:i,height2:s,height3:l,ctx1:c,ctx2:h,ctx3:u}=this,{r:d,g:g,b:p}=e;if("hsl"!==t){const e=Math.round(o.c2y/s*360);c.fillStyle=new D(`hsl(${e},100%,50%})`).toRgbString(),c.fillRect(0,0,n,i);const t=h.createLinearGradient(0,0,n,0);t.addColorStop(0,"rgba(255,255,255,1)"),t.addColorStop(1,"rgba(255,255,255,0)"),c.fillStyle=t,c.fillRect(0,0,n,i);const a=h.createLinearGradient(0,0,0,i);a.addColorStop(0,"rgba(0,0,0,0)"),a.addColorStop(1,"rgba(0,0,0,1)"),c.fillStyle=a,c.fillRect(0,0,n,i);const l=h.createLinearGradient(0,0,0,i);l.addColorStop(0,"rgba(255,0,0,1)"),l.addColorStop(.17,"rgba(255,255,0,1)"),l.addColorStop(.34,"rgba(0,255,0,1)"),l.addColorStop(.51,"rgba(0,255,255,1)"),l.addColorStop(.68,"rgba(0,0,255,1)"),l.addColorStop(.85,"rgba(255,0,255,1)"),l.addColorStop(1,"rgba(255,0,0,1)"),h.fillStyle=l,h.fillRect(0,0,r,s)}else{const t=c.createLinearGradient(0,0,n,0),r=Math.round(100*(1-o.c2y/s));t.addColorStop(0,new D("rgba(255,0,0,1)").desaturate(100-r).toRgbString()),t.addColorStop(.17,new D("rgba(255,255,0,1)").desaturate(100-r).toRgbString()),t.addColorStop(.34,new D("rgba(0,255,0,1)").desaturate(100-r).toRgbString()),t.addColorStop(.51,new D("rgba(0,255,255,1)").desaturate(100-r).toRgbString()),t.addColorStop(.68,new D("rgba(0,0,255,1)").desaturate(100-r).toRgbString()),t.addColorStop(.85,new D("rgba(255,0,255,1)").desaturate(100-r).toRgbString()),t.addColorStop(1,new D("rgba(255,0,0,1)").desaturate(100-r).toRgbString()),c.fillStyle=t,c.fillRect(0,0,n,i);const u=c.createLinearGradient(0,0,0,i);u.addColorStop(0,"rgba(255,255,255,1)"),u.addColorStop(.5,"rgba(255,255,255,0)"),c.fillStyle=u,c.fillRect(0,0,n,i);const b=c.createLinearGradient(0,0,0,i);b.addColorStop(.5,"rgba(0,0,0,0)"),b.addColorStop(1,"rgba(0,0,0,1)"),c.fillStyle=b,c.fillRect(0,0,n,i);const m=h.createLinearGradient(0,0,0,s),f=e.clone().greyscale().toRgb();m.addColorStop(0,`rgba(${d},${g},${p},1)`),m.addColorStop(1,`rgba(${f.r},${f.g},${f.b},1)`),h.fillStyle=m,h.fillRect(0,0,a,l)}if("hex"!==t){u.clearRect(0,0,a,l);const e=u.createLinearGradient(0,0,0,l);e.addColorStop(0,`rgba(${d},${g},${p},1)`),e.addColorStop(1,`rgba(${d},${g},${p},0)`),u.fillStyle=e,u.fillRect(0,0,a,l)}}handleFocusOut({relatedTarget:e}){e&&!this.parent.contains(e)&&this.hide(!0)}handleDismiss({code:e}){const t=this;t.isOpen&&"Escape"===e&&t.hide()}handleScroll(e){const{activeElement:t}=document;(Z&&this.dragElement||t&&this.controlKnobs.includes(t))&&(e.stopPropagation(),e.preventDefault()),this.updateDropdownPosition()}menuKeyHandler(e){const{target:t,code:o}=e;[K,q].includes(o)?e.preventDefault():[_,j].includes(o)&&this.menuClickHandler({target:t})}menuClickHandler(e){const t=this,{target:o}=e,{format:n}=t,r=(ue(o,"data-value")||"").trim(),a=t.colorMenu.querySelector("li.active"),i=c.includes(r)?"white":r;var s;t.color=new D(i,n),t.setControlPositions(),t.setColorAppearence(),t.updateInputs(!0),t.updateControls(),t.updateVisuals(),a&&(ce(a,"active"),s="aria-selected",a.removeAttribute(s)),a!==o&&(le(o,"active"),he(o,"aria-selected","true"),c.includes(r)&&(t.value=r,we(t)))}pointerDown(e){const t=this,{type:o,target:r,touches:a,pageX:i,pageY:s}=e,{visuals:l,controlKnobs:c,format:h}=t,[u,d,g]=l,[p,b,m]=c,f="canvas"===r.tagName?r:n("canvas",r.parentElement),w=oe(f),v="touchstart"===o?a[0].pageX:i,x="touchstart"===o?a[0].pageY:s,k=v-window.pageXOffset-w.left,y=x-window.pageYOffset-w.top;r===u||r===p?(t.dragElement=f,t.changeControl1(k,y)):r===d||r===b?(t.dragElement=f,t.changeControl2(y)):"hex"===h||r!==g&&r!==m||(t.dragElement=f,t.changeAlpha(y)),e.preventDefault()}pointerUp({target:e}){const t=this,o=document.getSelection();t.dragElement||o.toString().length||t.parent.contains(e)||t.hide(),t.dragElement=null}pointerMove(e){const t=this,{dragElement:o,visuals:n,format:r}=t,[a,i,s]=n,{type:l,touches:c,pageX:h,pageY:u}=e;if(!o)return;const d=oe(o),g="touchmove"===l?c[0].pageX:h,p="touchmove"===l?c[0].pageY:u,b=g-window.pageXOffset-d.left,m=p-window.pageYOffset-d.top;o===a&&t.changeControl1(b,m),o===i&&t.changeControl2(m),o===s&&"hex"!==r&&t.changeAlpha(m)}handleKnobs(e){const{target:t,code:o}=e,n=this;if(![q,K,U,G].includes(o))return;e.preventDefault();const{activeElement:r}=document,{controlKnobs:a}=n,i=a.find(e=>e===r),[s,l,c]=a;if(i){let r=0,a=0;t===s?([U,G].includes(o)?n.controlPositions.c1x+=o===G?1:-1:[q,K].includes(o)&&(n.controlPositions.c1y+=o===K?1:-1),r=n.controlPositions.c1x,a=n.controlPositions.c1y,n.changeControl1(r,a)):t===l?(n.controlPositions.c2y+=[K,G].includes(o)?1:-1,a=n.controlPositions.c2y,n.changeControl2(a)):t===c&&(n.controlPositions.c3y+=[K,G].includes(o)?1:-1,a=n.controlPositions.c3y,n.changeAlpha(a)),n.setColorAppearence(),n.updateInputs(),n.updateControls(),n.updateVisuals(),n.handleScroll(e)}}changeHandler(){const e=this;let t;const{activeElement:o}=document,{inputs:n,format:r,value:a,input:i}=e,[s,l,h,u]=n,d=e.includeNonColor&&c.includes(a);(o===i||o&&n.includes(o))&&(t=o===i?d?"white":a:"hex"===r?s.value:"hsl"===r?`hsla(${s.value},${l.value}%,${h.value}%,${u.value})`:`rgba(${n.map(e=>e.value).join(",")})`,e.color=new D(t,r),e.setControlPositions(),e.setColorAppearence(),e.updateInputs(),e.updateControls(),e.updateVisuals(),o===i&&d&&(e.value=a))}changeControl1(e,t){let[o,n]=[0,0];const{format:r,controlPositions:a,height1:i,height2:s,height3:l,width1:c}=this;e>c?o=c:e>=0&&(o=e),t>i?n=i:t>=0&&(n=t);const h="hsl"!==r?Math.round(a.c2y/s*360):Math.round(o/c*360),u="hsl"!==r?Math.round(o/c*100):Math.round(100*(1-a.c2y/s)),d=Math.round(100*(1-n/i)),g="hex"!==r?Math.round(100*(1-a.c3y/l))/100:1,p="hsl"!==r?"hsva":"hsla";this.color=new D(`${p}(${h},${u}%,${d}%,${g})`,r),this.controlPositions.c1x=o,this.controlPositions.c1y=n,this.setColorAppearence(),this.updateInputs(),this.updateControls(),this.updateVisuals()}changeControl2(e){const{format:t,width1:o,height1:n,height2:r,height3:a,controlPositions:i}=this;let s=0;e>r?s=r:e>=0&&(s=e);const l="hsl"!==t?Math.round(s/r*360):Math.round(i.c1x/o*360),c="hsl"!==t?Math.round(i.c1x/o*100):Math.round(100*(1-s/r)),h=Math.round(100*(1-i.c1y/n)),u="hex"!==t?Math.round(100*(1-i.c3y/a))/100:1,d="hsl"!==t?"hsva":"hsla";this.color=new D(`${d}(${l},${c}%,${h}%,${u})`,t),this.controlPositions.c2y=s,this.setColorAppearence(),this.updateInputs(),this.updateControls(),this.updateVisuals()}changeAlpha(e){const{height3:t}=this;let o=0;e>t?o=t:e>=0&&(o=e);const n=Math.round(100*(1-o/t));this.color.setAlpha(n/100),this.controlPositions.c3y=o,this.updateInputs(),this.updateControls()}updateDropdownPosition(){const{input:e,colorPicker:t,colorMenu:o}=this,n=oe(e),{top:r,bottom:a}=n,{offsetHeight:i}=e,s=document.documentElement.clientHeight,l=se(t,"show")?t:o,{offsetHeight:c}=l,h=s-a,u=r,d=r+c+i>s,g=r-c<0;(se(l,"bottom")||!g)&&h<u&&d?(ce(l,"bottom"),le(l,"top")):(ce(l,"top"),le(l,"bottom"))}setControlPositions(){const e=this,{hsv:t,hsl:o,format:n,height1:r,height2:a,height3:i,width1:s}=e,l=o.h,c="hsl"!==n?t.s:o.s,h="hsl"!==n?t.v:o.l,u=t.a;e.controlPositions.c1x="hsl"!==n?c*s:l/360*s,e.controlPositions.c1y=(1-h)*r,e.controlPositions.c2y="hsl"!==n?l/360*a:(1-c)*a,"hex"!==n&&(e.controlPositions.c3y=(1-u)*i)}setColorAppearence(){const{componentLabels:e,colorLabels:t,color:o,hsl:n,hsv:r,hex:a,format:i,controlKnobs:s}=this,{appearanceLabel:l,hexLabel:c,valueLabel:h}=e,{r:u,g:d,b:g}=o.toRgb(),[p,b,m]=s,f=Math.round(n.h),w=r.a,v="hsl"===i?n.s:r.s,x=Math.round(100*v),k=Math.round(100*n.l),y=100*r.v;let S;if(100===k&&0===x)S=t.white;else if(0===k)S=t.black;else if(0===x)S=t.grey;else if(f<15||f>=345)S=t.red;else if(f>=15&&f<45)S=y>80&&x>80?t.orange:t.brown;else if(f>=45&&f<75){const e=f>=54&&f<75&&y<80;S=f>46&&f<54&&y<80&&x>90?t.gold:t.yellow,S=e?t.olive:S}else f>=75&&f<155?S=y<68?t.green:t.lime:f>=155&&f<175?S=t.teal:f>=175&&f<195?S=t.cyan:f>=195&&f<255?S=t.blue:f>=255&&f<270?S=t.violet:f>=270&&f<295?S=t.magenta:f>=295&&f<345&&(S=t.pink);let C=`${c} ${a.split("").join(" ")}`;if("hsl"===i?(C=`HSL: ${f}, ${x}%, ${k}%`,he(p,"aria-description",`${h}: ${C}. ${l}: ${S}.`),he(p,"aria-valuetext",`${f}° & ${k}%`),he(p,"aria-valuenow",""+f),he(b,"aria-valuetext",x+"%"),he(b,"aria-valuenow",""+x)):(he(p,"aria-valuetext",`${k}% & ${x}%`),he(p,"aria-valuenow",""+k),he(b,"aria-valuetext",f+"°"),he(b,"aria-valuenow",""+f),C="rgb"===i?`RGB: ${u}, ${d}, ${g}`:C,he(b,"aria-description",`${h}: ${C}. ${l}: ${S}.`)),"hex"!==i){const e=Math.round(100*w);he(m,"aria-valuetext",e+"%"),he(m,"aria-valuenow",""+e)}}updateControls(){const{format:e,controlKnobs:t,controlPositions:o}=this,[n,r,a]=t;n.style.transform=`translate3d(${o.c1x-3}px,${o.c1y-3}px,0)`,r.style.transform=`translate3d(0,${o.c2y-3}px,0)`,"hex"!==e&&(a.style.transform=`translate3d(0,${o.c3y-3}px,0)`)}updateInputs(e){const t=this,{value:o,rgb:n,hsl:a,hsv:i,format:s,parent:l,input:c,inputs:h}=t,[u,d,g,p]=h,b=a.a,m=Math.round(a.h),f=Math.round(100*a.s),w="hsl"===s?a.l:i.v,v=Math.round(100*w);let x;"hex"===s?(x=t.color.toHexString(),u.value=t.hex):"hsl"===s?(x=t.color.toHslString(),u.value=""+m,d.value=""+f,g.value=""+v,p.value=""+b):"rgb"===s&&(x=t.color.toRgbString(),u.value=""+n.r,d.value=""+n.g,g.value=""+n.b,p.value=""+b),t.value=""+x,r(c.style,{backgroundColor:x}),t.isDark?(se(l,"light")&&ce(l,"light"),se(l,"dark")||le(l,"dark")):(se(l,"dark")&&ce(l,"dark"),se(l,"light")||le(l,"light")),e||x===o||we(t)}keyHandler(e){const t=this,{menuToggle:o}=t,{activeElement:n}=document,{code:r}=e;[_,j].includes(r)&&(o&&n===o||!n)&&(e.preventDefault(),n?t.toggleMenu():t.togglePicker(e))}togglePicker(e){e.preventDefault();const t=this,{colorPicker:o}=t;t.isOpen&&se(o,"show")?t.hide(!0):xe(t,o)}showPicker(){const e=this,{colorPicker:t}=e;se(t,"show")||xe(e,t)}toggleMenu(){const e=this,{colorMenu:t}=e;e.isOpen&&se(t,"show")?e.hide(!0):xe(e,t)}show(){const e=this;e.isOpen||(fe(e,!0),e.updateDropdownPosition(),e.isOpen=!0,he(e.input,"tabindex","0"),he(e.menuToggle,"tabindex","0"))}hide(e){const t=this;if(t.isOpen){const{pickerToggle:o,menuToggle:r,colorPicker:a,colorMenu:s,parent:l,input:c}=t,h=se(a,"show"),u=h?a:s,d=h?o:r,g=function(e){const t=i(e,"transitionProperty"),o=i(e,"transitionDuration"),n=o.includes("ms")?1:1e3,r=t&&"none"!==t?parseFloat(o)*n:0;return Number.isNaN(r)?0:r}(u);u&&(ce(u,"show"),he(d,"aria-expanded","false"),setTimeout(()=>{ve(u),n(".show",l)||(ce(l,"open"),fe(t),t.isOpen=!1)},g)),t.isValid||(t.value=t.color.toString()),e||o.focus(),he(c,"tabindex","-1"),he(r,"tabindex","-1")}}dispose(){const{input:e,parent:t}=this;this.hide(!0),me(this),[...t.children].forEach(t=>{t!==e&&t.remove()}),s(e,{backgroundColor:""}),["light","dark"].forEach(e=>ce(t,e)),ie.remove(e,"color-picker")}}r(ke,{Color:D,Version:"0.0.1alpha2",getInstance:pe,init:e=>new ke(e),selector:'[data-function="color-picker"]'});class ye extends HTMLElement{constructor(){super(),this.isDisconnected=!0,this.attachShadow({mode:"open"})}get value(){return this.input?this.input.value:null}get color(){return this.colorPicker?this.colorPicker.color:null}connectedCallback(){if(this.colorPicker)return void(this.isDisconnected&&(this.isDisconnected=!1));let e=n("input",this);e||(e=a({tagName:"input",type:"text",value:"#069",className:"color-preview button-appearance"}),this.append(e)),this.input=e,this.input&&(this.colorPicker=new ke(this.input),this.shadowRoot&&this.shadowRoot.append(a("slot")),this.isDisconnected=!1)}disconnectedCallback(){this.colorPicker&&this.colorPicker.dispose(),this.isDisconnected=!0}}return r(ye,{Color:D,ColorPicker:ke,Version:"0.0.1alpha2"}),customElements.define("color-picker",ye),ye}));
